{% extends 'base.html' %}
{% block title %}{{ report.title }} - Reports{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-8">
    <p class="text-muted small">Published {{ report.created_at.strftime('%b %d, %Y') }}</p>
    <h1 class="display-6 fw-bold mb-4">{{ report.title }}</h1>
    <article class="report-body">{{ report.body_html|safe }}</article>
    <section class="mt-5">
      <h3 class="h5">Comments</h3>
      {% for c in comments %}
        <div class="border rounded-4 p-3 mb-3">
          <div class="small text-muted">{{ c.created_at.strftime('%b %d, %Y %H:%M') }}</div>
          <p class="mb-0">{{ c.body }}</p>
        </div>
      {% else %}
        <p class="text-muted">No comments yet.</p>
      {% endfor %}
      {% if current_user.is_authenticated %}
        {% if current_user.status == 'muted' %}
          <div class="alert alert-warning">You are muted and cannot comment.</div>
        {% elif not current_user.email_verified %}
          <div class="alert alert-info">Verify your email to participate.</div>
        {% else %}
          <form method="post" action="{{ url_for('add_comment', parent_type='report', parent_id=report.id) }}">
            {{ csrf_token() }}
            <textarea class="form-control mb-2" name="body" rows="3" placeholder="Share your perspective"></textarea>
            <button class="btn btn-primary">Submit</button>
          </form>
        {% endif %}
      {% else %}
        <p><a href="{{ url_for('login') }}">Login</a> to comment.</p>
      {% endif %}
    </section>
  </div>
  <div class="col-lg-4">
    <div class="p-4 bg-light border rounded-4">
      <h3 class="h6 text-uppercase text-muted">About this report</h3>
      <p class="mb-1">Prepared by our research collective for academic review.</p>
      <small class="text-muted">Last updated {{ report.updated_at.strftime('%b %d, %Y') }}</small>
    </div>
  </div>
</div>
{% endblock %}
